<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Đăng nhập</title>
<link rel="stylesheet" href="assets/vendors/bootstrap/bootstrap.min.css">
<link rel="stylesheet" href="assets/css/style.css">
<style>
    .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
        width: 350px; background: white; padding: 20px; box-shadow: 0px 0px 15px gray; border-radius: 10px; 
        z-index: 1000; text-align: center; }
    .modal input, .modal button { width: 100%; padding: 10px; margin-top: 10px; }
    .close { float: right; cursor: pointer; font-size: 18px; }
</style>
</head>
<body>
    <section class="login_box_area">
        <div class="container">
            <div class="row">
                <div class="col-lg-6"><h3>Đăng nhập</h3>
                    <form action="account" method="post">
                        <input type="hidden" name="action" value="login">
                        <input type="text" name="username" placeholder="Tên đăng nhập" required>
                        <input type="password" name="password" placeholder="Mật khẩu" required>
                        <button type="submit">Đăng nhập</button>
                    </form>
                    <a href="#" id="forgotPasswordLink">Quên mật khẩu?</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Popup nhập email -->
    <div id="forgotPasswordModal" class="modal">
        <span class="close">&times;</span>
        <h4>Khôi phục mật khẩu</h4>
        <p>Nhập email để nhận mật khẩu mới:</p>
        <form id="forgotPasswordForm">
            <input type="hidden" name="action" value="forgotPassword">
            <input type="email" name="email" placeholder="Nhập email" required>
            <button type="submit">Gửi</button>
        </form>
        <p id="message"></p>
    </div>

    <script>
        document.getElementById("forgotPasswordLink").addEventListener("click", function () {
            document.getElementById("forgotPasswordModal").style.display = "block";
        });

        document.querySelector(".close").addEventListener("click", function () {
            document.getElementById("forgotPasswordModal").style.display = "none";
        });

        document.getElementById("forgotPasswordForm").addEventListener("submit", function (event) {
            event.preventDefault();
            var formData = new FormData(this);
            
            fetch("account", { method: "POST", body: formData })
            .then(response => response.text())
            .then(data => {
                var message = document.getElementById("message");
                if (data === "success") {
                    message.style.color = "green";
                    message.innerText = "Mật khẩu mới đã được gửi qua email.";
                } else {
                    message.style.color = "red";
                    message.innerText = "Lỗi! Không tìm thấy email.";
                }
            });
        });
    </script>
</body>
</html>
